schema: '2.0'
stages:
  preprocess_background:
    cmd: python src/data/remove_background.py --input data/raw --output 
      data/processed
    deps:
    - path: data/raw
      hash: md5
      md5: 7ad555ec0363a892d35743fe5ec2038c.dir
      size: 909741
      nfiles: 12
    - path: src/data/remove_background.py
      hash: md5
      md5: 311142ec8ebbf6560b294f41d0c3ceee
      size: 3139
    outs:
    - path: data/processed
      hash: md5
      md5: e8d0f42752733c405e80a8665f54146b.dir
      size: 2245538
      nfiles: 12
  split_data:
    cmd: python src/data/split_data.py --input data/processed --output 
      data/dataset_split
    deps:
    - path: data/processed
      hash: md5
      md5: e8d0f42752733c405e80a8665f54146b.dir
      size: 2245538
      nfiles: 12
    - path: src/data/split_data.py
      hash: md5
      md5: ed2ca580ef70b906fdf2ee6830863b21
      size: 3484
    params:
      params.yaml:
        split:
          train_size: 0.7
          val_size: 0.15
          test_size: 0.15
          seed: 42
    outs:
    - path: data/dataset_split
      hash: md5
      md5: 0aba04a459c7f74d4660defe284e10a4.dir
      size: 2245538
      nfiles: 12
  augment_train:
    cmd: python src/data/augment.py --input data/dataset_split/train --output 
      data/dataset_train_final --type pill
    deps:
    - path: data/dataset_split/train
      hash: md5
      md5: c9df15e2e8567f251f4ef58afc4268f1.dir
      size: 1494328
      nfiles: 8
    - path: src/data/augment.py
      hash: md5
      md5: 6a763bd63cca6af1dbfef6518d6e0df9
      size: 5144
    params:
      params.yaml:
        augment.pill:
          target_per_class: 350
          geometry:
            rotation: 15
            translate: 0.1
            scale_min: 0.85
            scale_max: 1.15
            shear: 5
          color:
            brightness: 0.2
            contrast: 0.2
            saturation: 0.2
    outs:
    - path: data/dataset_train_final
      hash: md5
      md5: 4decf4ea735adbc9ffa6a77f159db93d.dir
      size: 132329714
      nfiles: 701
  train_pill:
    cmd: python src/train.py --train_dir data/dataset_train_final --val_dir 
      data/dataset_split/val --output_dir experiments/arcface_lite_v1 --type 
      pill
    deps:
    - path: data/dataset_split/val
      hash: md5
      md5: 3f21324304c29739bcd24b4b55280eb0.dir
      size: 386837
      nfiles: 2
    - path: data/dataset_train_final
      hash: md5
      md5: 4decf4ea735adbc9ffa6a77f159db93d.dir
      size: 132329714
      nfiles: 701
    - path: src/data/dataset.py
      hash: md5
      md5: 23d75ec6b6deee76290922aef5045849
      size: 1604
    - path: src/models/architecture.py
      hash: md5
      md5: 1b1845f920a565b22e3cb27749d4ba96
      size: 2433
    - path: src/train.py
      hash: md5
      md5: 76992b13a2fc81112140737ef9d2b72b
      size: 8668
    params:
      params.yaml:
        train.pill:
          model_name: convnext_tiny
          img_size: 224
          batch_size: 16
          epochs: 1
          lr: 0.0001
          weight_decay: 0.0001
          dropout: 0.3
          embed_dim: 512
          focal:
            gamma: 2.0
            alpha: 0.25
          seed: 42
          num_workers: 0
    outs:
    - path: experiments/arcface_lite_v1/pill
      hash: md5
      md5: 32170a514b987af9de09c6c4e50ea12f.dir
      size: 451803986
      nfiles: 4
  preprocess_box:
    cmd: python src/data/remove_background.py --input data/raw_box --output 
      data/processed_box
    deps:
    - path: data/raw_box
      hash: md5
      md5: 1dcf8a86e0692fe2737bd35a333d1b21.dir
      size: 839055
      nfiles: 13
    - path: src/data/remove_background.py
      hash: md5
      md5: 311142ec8ebbf6560b294f41d0c3ceee
      size: 3139
    outs:
    - path: data/processed_box
      hash: md5
      md5: 5150ebb7b7d463af0e6550dd6432f50a.dir
      size: 1975888
      nfiles: 13
  split_box:
    cmd: python src/data/split_data.py --input data/processed_box --output 
      data/dataset_split_box
    deps:
    - path: data/processed_box
      hash: md5
      md5: 5150ebb7b7d463af0e6550dd6432f50a.dir
      size: 1975888
      nfiles: 13
    - path: src/data/split_data.py
      hash: md5
      md5: ed2ca580ef70b906fdf2ee6830863b21
      size: 3484
    params:
      params.yaml:
        split:
          train_size: 0.7
          val_size: 0.15
          test_size: 0.15
          seed: 42
    outs:
    - path: data/dataset_split_box
      hash: md5
      md5: a6e12ecdf9f992496db18484348ec0fd.dir
      size: 1975888
      nfiles: 13
  augment_box:
    cmd: python src/data/augment.py --input data/dataset_split_box/train 
      --output data/dataset_train_final_box --type box
    deps:
    - path: data/dataset_split_box/train
      hash: md5
      md5: 3aa60dd0a10345c2e1c00294a253ad0a.dir
      size: 1233537
      nfiles: 8
    - path: src/data/augment.py
      hash: md5
      md5: 6a763bd63cca6af1dbfef6518d6e0df9
      size: 5144
    params:
      params.yaml:
        augment.box:
          target_per_class: 500
          geometry:
            rotation: 90
            translate: 0.2
            scale_min: 0.8
            scale_max: 1.2
            shear: 10
          color:
            brightness: 0.3
            contrast: 0.3
            saturation: 0.3
    outs:
    - path: data/dataset_train_final_box
      hash: md5
      md5: 0cb6cf2cfd4b07c7c28433e5b01b04b4.dir
      size: 148722764
      nfiles: 1001
  train_box:
    cmd: python src/train.py --train_dir data/dataset_train_final_box --val_dir 
      data/dataset_split_box/val --output_dir experiments/arcface_lite_v1 --type
      box
    deps:
    - path: data/dataset_split_box/val
      hash: md5
      md5: efed634f822fb3a5e282bf40dace7891.dir
      size: 320000
      nfiles: 2
    - path: data/dataset_train_final_box
      hash: md5
      md5: 0cb6cf2cfd4b07c7c28433e5b01b04b4.dir
      size: 148722764
      nfiles: 1001
    - path: src/data/dataset.py
      hash: md5
      md5: 23d75ec6b6deee76290922aef5045849
      size: 1604
    - path: src/models/architecture.py
      hash: md5
      md5: 1b1845f920a565b22e3cb27749d4ba96
      size: 2433
    - path: src/train.py
      hash: md5
      md5: 76992b13a2fc81112140737ef9d2b72b
      size: 8668
    params:
      params.yaml:
        train.box:
          model_name: convnext_small
          img_size: 224
          batch_size: 16
          epochs: 1
          lr: 0.0001
          weight_decay: 0.0001
          dropout: 0.5
          embed_dim: 512
          focal:
            gamma: 2.0
            alpha: 0.25
          seed: 42
          num_workers: 0
    outs:
    - path: experiments/arcface_lite_v1/box
      hash: md5
      md5: 156b1ff3e838ea4bc5830c703d2380c1.dir
      size: 798219862
      nfiles: 4
