schema: '2.0'
stages:
  preprocess_box:
    cmd: python src/data/remove_background.py --input data/raw_box --output 
      data/processed_box
    deps:
    - path: data/raw_box
      hash: md5
      md5: 11ff3c195a80868f4e7de0062e1a9bea.dir
      size: 7360362
      nfiles: 123
    - path: src/data/remove_background.py
      hash: md5
      md5: 8b96c4610784a982273f4b16436a73d9
      size: 3749
    outs:
    - path: data/processed_box
      hash: md5
      md5: 4780746e6ef07b0dbabd07bea7a3319e.dir
      size: 19036051
      nfiles: 121
  split_box:
    cmd: python src/data/split_data.py --input data/processed_box --output 
      data/dataset_split_box
    deps:
    - path: data/processed_box
      hash: md5
      md5: 4780746e6ef07b0dbabd07bea7a3319e.dir
      size: 19036051
      nfiles: 121
    - path: src/data/split_data.py
      hash: md5
      md5: 028308f6ef18eb9f907c165ea0303708
      size: 2863
    params:
      params.yaml:
        split:
          val_ratio: 0.2
          test_ratio: 0.1
          seed: 42
    outs:
    - path: data/dataset_split_box
      hash: md5
      md5: 1612b8e83bd5db1e0f4eda1d6693fe78.dir
      size: 19036051
      nfiles: 121
  augment_box:
    cmd: python src/data/augment.py --input data/dataset_split_box/train 
      --output data/dataset_train_final_box --type box
    deps:
    - path: data/dataset_split_box/train
      hash: md5
      md5: 5d500733ca76c61aa32bf6d6d7a7b6ed.dir
      size: 12254461
      nfiles: 78
    - path: src/data/augment.py
      hash: md5
      md5: ec107f83c0410206702b58e27f35bd69
      size: 5413
    params:
      params.yaml:
        augment.box:
          target_per_class: 50
          aug_params:
            rotate_limit: 15
            p_rotate: 0.5
            p_vertical_flip: 0.0
            p_horizontal_flip: 0.5
            p_brightness: 0.2
            shift_limit: 0.05
            scale_limit: 0.1
            perspective_scale: 0.1
    outs:
    - path: data/dataset_train_final_box
      hash: md5
      md5: 04ffe2e91aa4697043cd8b6c60054059.dir
      size: 73243741
      nfiles: 440
  train_box:
    cmd: python src/train.py --train_dir data/dataset_train_final_box --val_dir 
      data/dataset_split_box/val --output_dir experiments/arcface_lite_v1/box 
      --type box
    deps:
    - path: data/dataset_split_box/val
      hash: md5
      md5: 8775e05b3d6d6629c8647896c944d92b.dir
      size: 4227230
      nfiles: 27
    - path: data/dataset_train_final_box
      hash: md5
      md5: 04ffe2e91aa4697043cd8b6c60054059.dir
      size: 73243741
      nfiles: 440
    - path: src/train.py
      hash: md5
      md5: 314253bc0a7b2e072cde9e1a4b085633
      size: 5384
    params:
      params.yaml:
        train.box:
          model_name: convnext_small
          img_size: 224
          batch_size: 16
          epochs: 1
          lr: 0.0001
          weight_decay: 0.0001
          dropout: 0.5
          embed_dim: 512
          focal:
            gamma: 2.0
            alpha: 0.25
          seed: 42
          num_workers: 0
    outs:
    - path: experiments/arcface_lite_v1/box
      hash: md5
      md5: da36d3b808977ed33b457f15889f9569.dir
      size: 199570239
      nfiles: 2
  finetune_box:
    cmd: python src/finetune.py --data_dir data/dataset_train_final_box 
      --old_model_dir experiments/arcface_lite_v1/box --output_dir 
      experiments/arcface_finetuned/box --type box
    deps:
    - path: data/dataset_train_final_box
      hash: md5
      md5: 04ffe2e91aa4697043cd8b6c60054059.dir
      size: 73243741
      nfiles: 440
    - path: experiments/arcface_lite_v1/box/best_model.pth
      hash: md5
      md5: 71a691c1c85618f37683c005eef5264a
      size: 199570017
    - path: src/finetune.py
      hash: md5
      md5: 64c5187bcb82743760bcfe899b3a653a
      size: 7503
    params:
      params.yaml:
        train.box:
          model_name: convnext_small
          img_size: 224
          batch_size: 16
          epochs: 1
          lr: 0.0001
          weight_decay: 0.0001
          dropout: 0.5
          embed_dim: 512
          focal:
            gamma: 2.0
            alpha: 0.25
          seed: 42
          num_workers: 0
    outs:
    - path: experiments/arcface_finetuned/box
      hash: md5
      md5: 10279f68a2783c66f66bd77ef7ef3b51.dir
      size: 199570239
      nfiles: 2
  preprocess_pill:
    cmd: python src/data/remove_background.py --input data/raw_pill --output 
      data/processed_pill
    deps:
    - path: data/raw_pill
      hash: md5
      md5: 806a6d04c7747c093b98f4a04a5c1131.dir
      size: 5164498
      nfiles: 62
    - path: src/data/remove_background.py
      hash: md5
      md5: 8b96c4610784a982273f4b16436a73d9
      size: 3749
    outs:
    - path: data/processed_pill
      hash: md5
      md5: ccaab98a69bcb880cdfac83968d5e8c4.dir
      size: 5260340
      nfiles: 60
  split_pill:
    cmd: python src/data/split_data.py --input data/processed_pill --output 
      data/dataset_split_pill
    deps:
    - path: data/processed_pill
      hash: md5
      md5: ccaab98a69bcb880cdfac83968d5e8c4.dir
      size: 5260340
      nfiles: 60
    - path: src/data/split_data.py
      hash: md5
      md5: 028308f6ef18eb9f907c165ea0303708
      size: 2863
    params:
      params.yaml:
        split:
          val_ratio: 0.2
          test_ratio: 0.1
          seed: 42
    outs:
    - path: data/dataset_split_pill
      hash: md5
      md5: 5177516ef1ad5afdf475d0fdbfb5b1e8.dir
      size: 5260340
      nfiles: 60
  augment_pill:
    cmd: python src/data/augment.py --input data/dataset_split_pill/train 
      --output data/dataset_train_final_pill --type pill
    deps:
    - path: data/dataset_split_pill/train
      hash: md5
      md5: 6df0334db9ac6c7a634004594afe8906.dir
      size: 2849344
      nfiles: 37
    - path: src/data/augment.py
      hash: md5
      md5: ec107f83c0410206702b58e27f35bd69
      size: 5413
    params:
      params.yaml:
        augment.pill:
          target_per_class: 50
          aug_params:
            rotate_limit: 180
            p_rotate: 0.8
            p_vertical_flip: 0.5
            p_horizontal_flip: 0.5
            p_brightness: 0.2
            blur_limit: 3
    outs:
    - path: data/dataset_train_final_pill
      hash: md5
      md5: eba7a1f7d0565862fc50b07ac4294ec6.dir
      size: 52718455
      nfiles: 318
  train_pill:
    cmd: python src/train.py --train_dir data/dataset_train_final_pill --val_dir
      data/dataset_split_pill/val --output_dir experiments/arcface_lite_v1/pill 
      --type pill
    deps:
    - path: data/dataset_split_pill/val
      hash: md5
      md5: 2b2b1db69ab609081572a6270765852f.dir
      size: 1591439
      nfiles: 15
    - path: data/dataset_train_final_pill
      hash: md5
      md5: eba7a1f7d0565862fc50b07ac4294ec6.dir
      size: 52718455
      nfiles: 318
    - path: src/train.py
      hash: md5
      md5: 314253bc0a7b2e072cde9e1a4b085633
      size: 5384
    params:
      params.yaml:
        train.pill:
          model_name: convnext_small
          img_size: 224
          batch_size: 16
          epochs: 2
          lr: 0.0001
          weight_decay: 0.0001
          dropout: 0.3
          embed_dim: 512
          focal:
            gamma: 2.0
            alpha: 0.25
          seed: 42
          num_workers: 0
    outs:
    - path: experiments/arcface_lite_v1/pill
      hash: md5
      md5: bd600ae753a28de3f34de016ac24f3e5.dir
      size: 199562336
      nfiles: 2
  finetune_pill:
    cmd: python src/finetune.py --data_dir data/dataset_train_final_pill 
      --old_model_dir experiments/arcface_lite_v1/pill --output_dir 
      experiments/arcface_finetuned/pill --type pill
    deps:
    - path: data/dataset_train_final_pill
      hash: md5
      md5: eba7a1f7d0565862fc50b07ac4294ec6.dir
      size: 52718455
      nfiles: 318
    - path: experiments/arcface_lite_v1/pill/best_model.pth
      hash: md5
      md5: f6bf35cb9468a2537643cfaba4ef217f
      size: 199562228
    - path: src/finetune.py
      hash: md5
      md5: 64c5187bcb82743760bcfe899b3a653a
      size: 7503
    params:
      params.yaml:
        train.pill:
          model_name: convnext_small
          img_size: 224
          batch_size: 16
          epochs: 2
          lr: 0.0001
          weight_decay: 0.0001
          dropout: 0.3
          embed_dim: 512
          focal:
            gamma: 2.0
            alpha: 0.25
          seed: 42
          num_workers: 0
    outs:
    - path: experiments/arcface_finetuned/pill
      hash: md5
      md5: 280bdf46185410d172c9ac5aba4fee8b.dir
      size: 199566472
      nfiles: 2
  evaluate_pill:
    cmd: python src/evaluate.py --test_dir data/dataset_split_pill/test 
      --model_dir experiments/arcface_finetuned/pill --metrics_out 
      metrics/pill_metrics.json --type pill --threshold 20.0
    deps:
    - path: data/dataset_split_pill/test
      hash: md5
      md5: 058582be4ca2f35a3b152de28e20f5e2.dir
      size: 819557
      nfiles: 8
    - path: experiments/arcface_finetuned/pill/best_model.pth
      hash: md5
      md5: 70fc6bc20928f933667725fd16da6a1f
      size: 199566324
    - path: src/evaluate.py
      hash: md5
      md5: 794c123055a1eb89e7dea88a05ced291
      size: 3375
    outs:
    - path: metrics/pill_metrics.json
      hash: md5
      md5: 13d1519a8ec326a783dc7853d5696880
      size: 44
